# SMITH Framework

SMITH – это модульный фреймворк для автоматизации разработки с помощью автономного AI‑агента.  Он построен вокруг трёх векторов: **Разум**, **Руки** и **Память**.  Разделение на эти компоненты делает систему гибкой и расширяемой.

## Архитектура

### Разум

За интеллектуальное поведение отвечает `smith_agent.py`/`smith_agent_stage1.py`, который принимает высокоуровневые запросы пользователя, разбирает их через **PromptParser**, строит граф задач с помощью **DynamicPlanner** и исполняет его через **PlanExecutor**.  Планировщик поддерживает условные ветвления, запросы подтверждения и параллельное выполнение независимых шагов.  Исполнитель управляет запуском тестов, линтеров и операций модификации кода.

### Руки

**Инструменты** находятся в каталоге `smith_tools`:

* `code_ops.py` – операции над кодовой базой: замена библиотек, обновление зависимостей, добавление API‑эндпоинтов для FastAPI/Flask, рефакторинг «GodObject».
* `context_engine.py` – семантический анализ Python‑кода.  Умеет извлекать классы и функции из файла, строить граф вызовов, искать использования символов в проекте и формировать импортный граф.  CLI поддерживает флаги `--find-usages`, `--import-graph` и `--call-graph`.
* `project_verifier.py` – запуск тестов (pytest) и линтеров (flake8); результаты используются планировщиком.
* `human_feedback_tool.py` – запросы подтверждений у пользователя.  В интерактивном режиме задаёт вопрос через консоль; behaviour можно переопределить переменной `SMITH_AUTO_CONFIRM`.
* `task_manager.py` – CLI для ведения списка задач (добавление, просмотр, изменение статуса).  Для запуска тестов предусмотрен параметр окружения `TASKS_FILE_OVERRIDE`.

### Память

Фреймворк сохраняет данные о проектах и задачах в каталоге `.gemini/memory` (см. переменную `smith_root_dir` в `config.yaml`).  Метаданные проекта (`.project_meta.json`) генерируются автоматически и используются для адаптации поведения (например, выбор FastAPI или Flask).  Журнал рефлексий (`reflections.log`) хранит результаты выполнения планов и позволяет агенту учиться на своих ошибках.

## Использование

### Агенты

Запуск агента через CLI:

```bash
# Анализ и выполнение запроса в корне проекта
python3 -m smith_tools.smith_agent_stage1 --prompt "Replace requests with httpx" --project-root /path/to/project

# SMITH_AGENT автоматически создаст .project_meta.json, построит план, спросит подтверждение (если необходимо) и запустит тесты.
```

Параметр `SMITH_AUTO_CONFIRM=false` заставит агента запрашивать подтверждение у пользователя.  Вы можете настроить `smith_root_dir` в `config.yaml` для определения расположения долговременной памяти.

### Контекстный движок

Для точечного анализа кода используйте `context_engine.py`:

```bash
# Структура файла: классы и функции
python3 -m smith_tools.context_engine path/to/file.py

# Поиск всех упоминаний символа foo в проекте
python3 -m smith_tools.context_engine path/to/project --find-usages foo

# Импортный граф проекта
python3 -m smith_tools.context_engine path/to/project --import-graph

# Граф вызовов в файле
python3 -m smith_tools.context_engine path/to/file.py --call-graph
```

### Менеджер задач

Менеджер задач предоставляет простую командную строку:

```bash
# Добавить задачу
python3 -m smith_tools.task_manager add --description "Implement feature X" --project MYPROJ

# Просмотреть задачи
python3 -m smith_tools.task_manager list

# Отметить задачу выполненной
python3 -m smith_tools.task_manager update 1 --status done
```

Во время тестирования можно переопределять путь к файлу задач переменной `TASKS_FILE_OVERRIDE`.

## Тестирование

Модульные тесты находятся в каталоге `smith_tools/tests`.  Чтобы убедиться, что ваша установка корректна, запустите:

```bash
python3 -m unittest discover -s smith_tools/tests
```

Все ключевые функции (`code_ops`, `dynamic_planner`, `plan_executor`, `task_manager`, `context_engine`) покрыты тестами, включая пограничные случаи.

## MCP-интерфейс (Model Context Protocol)

Для стандартизированного взаимодействия с AI-агентами, фреймворк может быть дополнен локальным MCP-сервером. Этот сервер выступает в роли безопасного шлюза, предоставляя доступ к инструментам SMITH через стандартизированный протокол.

Реализация сервера находится в директории `../MCP_Server_Project`. Он не является частью основного фреймворка, а представляет собой внешний компонент, который можно запустить для обеспечения интерактивного управления.

Подробности о его настройке и запуске см. в `../MCP_Server_Project/README.md`.

## Развитие

SMITH разработан модульно, поэтому расширить функциональность можно, добавляя новые действия в планировщик, инструменты в `smith_tools` и улучшая систему памяти.  Предложения по улучшениям приветствуются!